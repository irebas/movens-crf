SELECT
    i1.product_id,
    i1.product_name,
    i1.L1_SECTOR_ID,
    i1.L1_name,
    i1.L2_DEPARTMENT_ID,
    i1.L2_name,
    i1.L3_GROUP_ID,
    i1.L3_name,
    i1.L4_GROUP_SUB_ID,
    i1.L4_name,
    i1.category_role,
    i1.final_role,
    i2.VAT,
    i2.CZ3N,
    i2.CZ3B,
    i2.CZ4N,
    i2.CZ4B,
    i2.Synonim,
    i2.Indeks,
    i2."410" AS price_zone_410b,
    i2."420" AS price_zone_420b,
    i2."430" AS price_zone_430b,
    i2."440" AS price_zone_440b,
    i2."450" AS price_zone_450b,
    i2."502" AS price_zone_502b,
    i2."505" AS price_zone_505b,
    i2."506" AS price_zone_506b,
    i2."507" AS price_zone_507b,
    i2."900" AS price_zone_900b,
    i2."11" AS price_zone_11b,
    i2."12" AS price_zone_12b,
    i2."13" AS price_zone_13b,
    i2."21" AS price_zone_21b,
    i2."22" AS price_zone_22b,
    i2."23" AS price_zone_23b,
    i2."1" AS price_zone_1b,
    i2."211" AS price_zone_211b,
    i2."212" AS price_zone_212b,
    i2."213" AS price_zone_213b,
    i2."300" AS price_zone_300b,
    i2."301" AS price_zone_301b,
    i2."302" AS price_zone_302b,
    i2.med_auchan,
    i2.med_biedronka,
    i2.med_intermarche,
    i2.med_kaufland,
    i2.med_leclerc,
    i2.med_lidl,
    i2.med_netto,
    i2.med_rossmann,
    i3.margin_min,
    i3.margin_gama,
    i3.margin_komp,
    i3.margin_super_komp
FROM input_base i1
LEFT JOIN input2 i2 ON i1.product_id = i2.ArticleID
LEFT JOIN input_margin i3 ON i1.L4_GROUP_SUB_ID = i3.L4
WHERE i2.ArticleID IS NOT NULL AND i1.final_role IS NOT NULL
AND i1.final_role NOT IN ('Fixed Prices', 'In-out/ Seasonal', 'Out of project')
